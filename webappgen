#!/bin/bash

if [[ $# == 1 ]]; then
  prodDir=$1
  
  if [ -d "$prodDir" ]; then
    echo "Directory already exists!"
    exit
  fi
  
  randName=$RANDOM

  echo "Getting the zip file..."
  wget https://github.com/tommica/html5stripped/archive/master.zip -O "$randName.zip" -q

  echo "Generating folders..."
  unzip -qq "$randName.zip"
  rm "$randName.zip"
  mv html5stripped-master $prodDir
  cd $prodDir

  if hash sass 2>/dev/null; then
    if hash compass 2>/dev/null; then
      # Remove the base version of the base style
      cd css/sass
      rm base_1_bare.scss
      mv base_1_compass.scss base_1.scss
      # Remove normalizing, Compass has it's own
      cd ..
      rm normalize.css
      cd ..
      # Install Compass
      echo "Installing Compass..."
      compass create --sass-dir "sass" --css-dir "css" --javascripts-dir "scripts" --images-dir "images"

      # Move the SMACSS files to the sass directory
      mv css/sass sass/custom

      # And link to it
      printf "@import 'custom/xcombined';\n" >> "sass/screen.scss"
    else
      # Remove the compass version of the base style
      cd css/sass
      rm base_1_compass.scss
      mv base_1_bare.scss base_1.scss
      echo "Compass not installed..."
      cd ../..
    fi

    ./magic_watch 1
    echo "Compiling..."
  else
    echo "SASS does not exist..."
    echo "Compass not enabled..."
  fi

  cd ..
  echo "Finished!"
fi
